{"version":3,"sources":["utils/index.tsx","components/flow/FlowArc.tsx","geometry/index.tsx","components/flow/FlowNode.tsx","components/FlowNetworkEditor/SmartButton.tsx","components/FlowNetworkEditor/FlowNetworkEditor.tsx","maxflow/FordFulkerson.tsx","App.tsx","index.tsx"],"names":["asPixels","value","useStyles","createUseStyles","arcLabel","position","top","arrow","display","left","border","borderWidth","width","height","transform","FlowArc","props","a","b","rad","start","x","startX","y","startY","end","endX","endY","classes","capacity","flow","length","Math","sqrt","pow","pos","middle","orientation","atan","PI","angle","red","rgb","map","gCh","i","style","backgroundColor","join","className","makeStyles","theme","label","marginTop","spacing","FlowNode","memo","draggable","onClick","e","preventDefault","stopPropagation","id","onDrag","event","onDragStart","img","Image","src","dataTransfer","setDragImage","positionY","positionX","bgColor","SmartButton","disabled","otherProps","Button","variant","children","canvas","useMUIStyles","root","margin","grow","flexGrow","Node","this","Graph","_nodes","_adjacencyTable","Error","from","to","Object","entries","tos","filter","flat","absoluteCoordinate","normalizedCoordinate","absolutePosition","normalizedPosition","window","innerWidth","innerHeight","relativePosition","FlowNetworkEditor","muiClasses","useState","nodeData","setNodeData","arcs","setArcs","setFlow","undefined","source","setSource","sink","setSink","selectedNode","setSelectedNode","graph","values","forEach","node","addNode","addArc","dragHandler","useCallback","newPos","clientX","clientY","prev","canvasClickHandler","newNode","keys","nodeClickHandler","round","random","runClickHandler","Promise","resolve","arcsWithBackward","reduce","acc","findPath","visited","increase","newVisited","path","dest","find","currentFlow","arcIncrease","min","augmentingPath","Infinity","forward","fordFulkerson","then","deleteClickHandler","otherArcs","otherNodes","sourceMarkClickHandler","sinkMarkClickHandler","graphNodes","getNodes","AppBar","Toolbar","ButtonGroup","startIcon","color","getArcs","App","document","addEventListener","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.e7c00bc6.chunk.js","sourcesContent":["export function asPixels(value: number) {\n  return value + 'px'\n}\nexport function cssAngle(rad: number) {\n  return `rotate(${rad}rad)`\n}","import React from 'react'\nimport { angle, distance, middle } from '../../geometry/index';\nimport { asPixels, cssAngle } from '../../utils/index';\nimport { createUseStyles } from 'react-jss'\n\nconst useStyles = createUseStyles({\n  arcLabel: {\n    position: 'absolute',\n    top: '10px'\n  },\n  arrow: {\n    display: 'inline-block',\n    position: 'absolute',\n    top: '-2px',\n    left: '20px',\n    border: 'solid black',\n    borderWidth:' 0 3px 3px 0',\n    width: '6px',\n    height: '6px',\n    transform: 'rotate(-45deg)',\n  },\n})\n\nexport function FlowArc(props: {\n  startX: number,\n  startY: number,\n  endX: number,\n  endY: number,\n  capacity: number\n  flow: number\n}) {\n\n  const start = {x: props.startX, y: props.startY}\n  const end = {x: props.endX, y: props.endY}\n  const classes = useStyles()\n  const { capacity, flow } = props\n  const length = distance(start, end)\n  const pos = middle(start, end)\n  const orientation = angle(start, end)\n\n  const green = [0, 255, 0]\n  const red = [255, 0, 0]\n  const rgb = green.map((gCh, i) => gCh + (red[i] - gCh) * flow / capacity)\n  const style = {\n    top: asPixels(pos.y),\n    left: asPixels(pos.x),\n    width: asPixels(length),\n    transform: `translateX(${-length / 2}px)` + cssAngle(orientation),\n    backgroundColor: `rgb(${rgb.join(',')})`\n  }\n\n  return <div className='flow-arc' style={style}>\n    <i className={classes.arrow} />\n    <span className={classes.arcLabel}>{flow}/{capacity}</span>\n  </div>\n}","\nexport type Point = {\n  x: number;\n  y: number;\n}\nexport type RectangleSize = {\n  width: number\n  height: number\n}\n\nfunction randomPoint(): Point {\n  function randomCoordinate() {\n    return -1 + Math.random() * 2\n  }\n  return { x: randomCoordinate(), y: randomCoordinate() }\n}\n\nfunction distance(a: Point, b: Point) {\n  return Math.sqrt(Math.pow(a.x - b.x, 2) + Math.pow(a.y - b.y, 2))\n}\n\nfunction middle(a: Point, b: Point) {\n  return {\n    x: (a.x + b.x) / 2,\n    y: (a.y + b.y) / 2,\n  }\n}\n\nfunction angle(a: Point, b: Point) {\n  return Math.atan((b.y - a.y) / (b.x - a.x)) + ( b.x < a.x ? Math.PI : 0)\n}\n\nfunction absolutePosition(position: Point): Point {\n  return {\n    x: 250 + position.x * 250,\n    y: 250 + position.y * 250\n  }\n}\n\nexport {\n  distance,\n  middle,\n  angle,\n  randomPoint,\n  absolutePosition\n}","import { makeStyles } from \"@material-ui/core\";\nimport React, { DragEvent, memo } from \"react\"\n\nimport { asPixels } from '../../utils/index';\nimport { NodeId } from \"../types\";\n\nconst useStyles = makeStyles((theme) => ({\n  label: {\n\n    display: 'inline-block',\n    marginTop: theme.spacing(1)\n  },\n}));\n\nexport const FlowNode = memo((props: {\n  id: NodeId\n  positionX: number,\n  positionY: number,\n  onClick: (id: NodeId) => void\n  onDrag: (id: NodeId, event: DragEvent) => void\n  bgColor?: string\n  label?: React.ReactNode\n}) => {\n  const classes = useStyles()\n\n  const dragStartHandler = (event: DragEvent) => {\n    var img = new Image();\n    img.src = 'data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=';\n    event.dataTransfer.setDragImage(img, 0, 0);\n  }\n  return (\n    <div\n      className='flow-node'\n      draggable={true}\n      onClick={(e) => {\n        e.preventDefault()\n        e.stopPropagation()\n        props.onClick(props.id)\n      }}\n      onDrag={(event) => props.onDrag(props.id, event)}\n      onDragStart={dragStartHandler}\n      style={\n        {\n          top: asPixels(props.positionY),\n          left: asPixels(props.positionX),\n          backgroundColor: props.bgColor,\n        }}>\n      {props.id}\n      <span className={classes.label}>\n        {props.label}\n      </span>\n    </div>\n  )\n})\n\n\n","import { Button } from \"@material-ui/core\";\r\n\r\n\r\nexport function SmartButton(props: React.ComponentProps<typeof Button>) {\r\n    const {onClick, disabled, ...otherProps} = props\r\n    return <Button\r\n        variant='contained'\r\n        onClick={props.onClick}\r\n        disabled={!props.onClick}\r\n        {...otherProps}\r\n        >\r\n        {props.children}\r\n    </Button>\r\n}","import { AppBar, ButtonGroup, makeStyles, Toolbar } from \"@material-ui/core\";\n\nimport { useCallback, useState } from \"react\";\nimport { createUseStyles } from \"react-jss\";\nimport { Point } from \"../../geometry\";\nimport { fordFulkerson } from \"../../maxflow\";\nimport { FlowArc, FlowNetworkNode } from \"../flow\";\nimport { NodeId, NumericLabeledArcs } from \"../types\";\nimport { SmartButton } from \"./SmartButton\";\nimport FlagIcon from '@material-ui/icons/Flag';\nimport PlayArrowIcon from \"@material-ui/icons/PlayArrow\";\nimport InputIcon from '@material-ui/icons/Input';\nimport DeleteIcon from '@material-ui/icons/Delete';\n\nconst useStyles = createUseStyles({\n  canvas: {\n    width: '100%',\n    height: '100vh',\n  }\n})\n\nconst useMUIStyles = makeStyles((theme) => ({\n  root: {\n    '& > *': {\n      margin: theme.spacing(1),\n    },\n  },\n  grow: {\n    flexGrow: 1,\n  },\n}));\n\nclass Node<T>{\n  private id: NodeId\n  public value: T\n\n  constructor(id: NodeId, value: T) {\n    this.id = id;\n    this.value = value\n  }\n}\n\nclass Graph<T>{\n  private _nodes: { [id: string]: Node<T> } = {}\n  private _adjacencyTable: { [from: string]: { [to: string]: boolean } } = {}\n\n  addNode(id: string, value: T) {\n    if ((id in this._nodes)) {\n      throw new Error('Conflicting node id')\n    }\n\n    this._nodes[id] = new Node(id, value)\n  }\n\n  addArc(from: string, to: string) {\n    if (!this._adjacencyTable[from]) {\n      this._adjacencyTable[from] = {}\n    }\n    this._adjacencyTable[from][to] = true\n  }\n\n  getNodes() {\n    return this._nodes\n  }\n\n  getArcs() {\n    return Object.entries(this._adjacencyTable).map(([from, tos]) => {\n      return Object.entries(tos).filter(([, linked]) => linked).map(([to]) => [from, to])\n    }).flat()\n  }\n}\n\nclass FlowNode {\n  public id;\n  public position: Point\n  constructor(id: string, position: Point) {\n    this.id = id\n    this.position = position\n  }\n\n  toString() {\n    return this.id\n  }\n}\n\ntype NodeData = {\n  id: string,\n  position: Point,\n}\n\nfunction absoluteCoordinate(normalizedCoordinate: number, length: number) {\n  return (length + normalizedCoordinate * length) / 2\n}\nfunction normalizedCoordinate(absoluteCoordinate: number, length: number) {\n  return (absoluteCoordinate * 2 - length) / length\n}\n\nfunction absolutePosition(normalizedPosition: Point) {\n  return {\n    x: absoluteCoordinate(normalizedPosition.x, window.innerWidth),\n    y: absoluteCoordinate(normalizedPosition.y, window.innerHeight),\n  }\n}\n\nfunction relativePosition(absolutePosition: Point) {\n  return {\n    x: normalizedCoordinate(absolutePosition.x, window.innerWidth),\n    y: normalizedCoordinate(absolutePosition.y, window.innerHeight),\n  }\n}\n\nexport function FlowNetworkEditor() {\n  const muiClasses = useMUIStyles()\n  const [nodeData, setNodeData] = useState<{ [id: string]: NodeData }>({})\n  const [arcs, setArcs] = useState<NumericLabeledArcs>({})\n  const [flow, setFlow] = useState<NumericLabeledArcs>({})\n  const [source, setSource] = useState<NodeId | undefined>(undefined)\n  const [sink, setSink] = useState<NodeId | undefined>(undefined)\n  const [defaultArcCapacity] = useState(10)\n\n  const [selectedNode, setSelectedNode] = useState<NodeId | undefined>(undefined)\n\n  const graph = new Graph<FlowNode>();\n\n  Object.values(nodeData).forEach((node) => {\n    graph.addNode(node.id, new FlowNode(node.id, node.position))\n  })\n\n  for (const [from, tos] of Object.entries(arcs)) {\n    for (const [to] of Object.entries(tos)) {\n      graph.addArc(from, to)\n    }\n  }\n\n  const dragHandler = useCallback((id, event) => {\n    event.preventDefault()\n    const newPos = relativePosition({ x: event.clientX, y: event.clientY })\n    setNodeData((prev) => {\n      return {\n        ...prev,\n        [id]: {\n          id,\n          position: newPos\n        }\n      }\n    })\n  }, [setNodeData])\n\n  const canvasClickHandler = useCallback((e: React.MouseEvent) => {\n\n    setNodeData((prev) => {\n\n      //add a new node\n      const newNode = {\n        id: '' + Object.keys(prev).length,\n        position: relativePosition({ x: e.clientX, y: e.clientY })\n      }\n\n      return {\n        ...prev,\n        [newNode.id]: newNode,\n      }\n    })\n  }, [setNodeData])\n\n  const nodeClickHandler = useCallback((id: NodeId) => {\n    if(!selectedNode){\n      setSelectedNode(id)\n      return\n    }\n    //we add the new arc\n    if (id !== selectedNode && !arcs[selectedNode]?.[id] && !arcs[id]?.[selectedNode]) {\n      setArcs((prev) => ({\n        ...prev,\n        [selectedNode]: {\n          ...prev[selectedNode],\n          [id]: Math.round(8 * Math.random()) + 2\n        }\n      }))\n    }\n    setSelectedNode(undefined)\n  }, [selectedNode, setSelectedNode, arcs, setArcs])\n\n  const runClickHandler = source && sink ? () => {\n    new Promise<NumericLabeledArcs>((resolve) => {\n      const flow = fordFulkerson(source, sink, arcs)\n      resolve(flow)\n    }).then(setFlow)\n  } : undefined\n\n  const deleteClickHandler = selectedNode ? () => {\n    if (source === selectedNode) {\n      setSource(undefined)\n    }\n\n    if (sink === selectedNode) {\n      setSink(undefined)\n    }\n\n    setSelectedNode(undefined)\n\n    //remove the arcs from and to the node\n    const { [selectedNode]: fromDeletedNodeArcs, ...otherArcs } = arcs\n\n    //remove the ingoing arcs to the node\n    for (const tos of Object.values(otherArcs)) {\n      delete tos[selectedNode]\n    }\n\n    setArcs(otherArcs)\n    //remove the node\n    const { [selectedNode]: deletedNode, ...otherNodes } = nodeData\n    setNodeData(otherNodes)\n\n  } : undefined\n\n  const sourceMarkClickHandler = selectedNode && selectedNode !== sink ? () => {\n    if (selectedNode === source) {\n      setSource(undefined)\n    } else {\n      setSource(selectedNode)\n    }\n    setSelectedNode(undefined)\n  } : undefined\n\n  const sinkMarkClickHandler = selectedNode && selectedNode !== source ? () => {\n    if (selectedNode === sink) {\n      setSink(undefined)\n    } else {\n      setSink(selectedNode)\n    }\n    setSelectedNode(undefined)\n  } : undefined\n\n  const classes = useStyles()\n  const graphNodes = graph.getNodes()\n\n  return <>\n    <AppBar position=\"fixed\">\n      <Toolbar className={muiClasses.root}>\n        <div className={muiClasses.grow} />\n        <ButtonGroup variant='contained' >\n          <SmartButton onClick={sourceMarkClickHandler} startIcon={<InputIcon />}>{selectedNode === source ? 'Unm' : 'M'}ark as source</SmartButton>\n          <SmartButton onClick={sinkMarkClickHandler} startIcon={<FlagIcon />}>{selectedNode === sink ? 'Unm' : 'M'}ark as sink</SmartButton>\n          <SmartButton onClick={deleteClickHandler} startIcon={<DeleteIcon />}>Delete</SmartButton>\n        </ButtonGroup>\n        <SmartButton onClick={runClickHandler} color='primary' variant='contained' startIcon={<PlayArrowIcon />}>Compute</SmartButton>\n      </Toolbar>\n    </AppBar>\n    <div onClick={canvasClickHandler} className={classes.canvas}>\n      {\n        Object.values(graphNodes).map(({ value }) => {\n          const pos = absolutePosition(value.position)\n          return <FlowNetworkNode\n            key={value.id}\n            onDrag={dragHandler}\n            onClick={nodeClickHandler}\n            {...value}\n            positionX={pos.x}\n            positionY={pos.y}\n            bgColor={value.id === selectedNode ? 'red' : undefined}\n            label={sink === value.id ? <FlagIcon /> : (source === value.id ?  <InputIcon /> : undefined)}\n          />\n        })\n      }\n      {\n        graph.getArcs().map(([from, to]) => {\n          const start = absolutePosition(graphNodes[from].value.position)\n          const end = absolutePosition(graphNodes[to].value.position)\n          return <FlowArc\n            key={from + '-' + to}\n            flow={flow[from]?.[to] || 0}\n            capacity={arcs[from][to]}\n            startX={start.x}\n            startY={start.y}\n            endX={end.x}\n            endY={end.y}\n          />\n        })\n      }\n    </div>\n  </>\n\n}","type Arcs = { [from: string]: { [to: string]: number } }\r\n\r\nexport function fordFulkerson(source: string, sink: string, arcs: Arcs) {\r\n\r\n  const flow: Arcs = {}\r\n\r\n  const arcsWithBackward = Object.keys(arcs).reduce<Arcs>((acc, to) => {\r\n    for (const from of Object.keys(arcs[to])) {\r\n      if (!acc[from]) {\r\n        acc[from] = {}\r\n      }\r\n      if (!acc[to]) {\r\n        acc[to] = {}\r\n      }\r\n      acc[to][from] = arcs[to][from]\r\n      //mark backwards with negative capacity\r\n      acc[from][to] = -acc[to][from]\r\n    }\r\n    return acc\r\n  }, {})\r\n\r\n  function findPath(node: string, visited: string[], increase: number): { visited: string[], increase: number } | null {\r\n    const newVisited = [...visited, node]\r\n\r\n    if (node === sink) {\r\n      //we have arrived\r\n      return {\r\n        visited: newVisited,\r\n        increase\r\n      }\r\n    }\r\n\r\n    let path = null\r\n    for (const [dest, capacity] of Object.entries(arcsWithBackward[node] ?? {})) {\r\n\r\n      if (visited.find((e) => e === dest)) {\r\n        continue\r\n      }\r\n\r\n      const currentFlow = flow[node]?.[dest] ?? 0\r\n\r\n      //if capacity is negative we are looking at a backward arc\r\n      const arcIncrease = capacity >= 0 ? capacity - currentFlow : currentFlow\r\n\r\n      if (arcIncrease > 0) {\r\n        path = findPath(dest, newVisited, Math.min(increase, arcIncrease))\r\n        //we got a path\r\n        if (path) {\r\n          break\r\n        }\r\n      }\r\n    }\r\n\r\n    return path\r\n  }\r\n\r\n  let augmentingPath = findPath(source, [], Infinity)\r\n  while (augmentingPath) {\r\n    const visited = augmentingPath?.visited\r\n    for (let i = 0; i < visited.length - 1; i++) {\r\n      const [a, b] = [visited[i], visited[i + 1]]\r\n      if (!flow[a]) {\r\n        flow[a] = {}\r\n      }\r\n      //check if it was a backward arc\r\n      const forward = !!arcs[a][b]\r\n      const arcIncrease = augmentingPath.increase * (forward ? 1 : -1)\r\n\r\n      const [from, to] = forward ? [a, b] : [b, a]\r\n\r\n      if (!flow[from][to]) {\r\n        flow[from][to] = arcIncrease\r\n      } else {\r\n        flow[from][to] += arcIncrease\r\n      }\r\n    }\r\n\r\n    augmentingPath = findPath(source, [], Infinity)\r\n  }\r\n\r\n  return flow\r\n}","import './App.css'\nimport { FlowNetworkEditor } from './components/FlowNetworkEditor';\n\nfunction App() {\n\n  return (\n    <FlowNetworkEditor />\n  )\n}\n\nexport default App","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\ndocument.addEventListener('dragover', function (event) {\n\n  // prevent default to allow drop\n  event.preventDefault();\n\n}, false);\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n"],"sourceRoot":""}