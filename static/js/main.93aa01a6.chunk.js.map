{"version":3,"sources":["utils/index.tsx","components/flow/FlowArc.tsx","components/FlowNetworkEditor/FlowNetworkEditor.tsx","geometry/index.tsx","components/flow/FlowNode.tsx","components/FlowNetworkEditor/SmartButton.tsx","maxflow/FordFulkerson.tsx","App.tsx","index.tsx"],"names":["asPixels","value","EDITOR_ACTIONS","useStyles","createUseStyles","arcLabel","position","top","arrow","display","left","border","borderWidth","width","height","transform","FlowArc","memo","props","a","b","rad","start","x","startX","y","startY","end","endX","endY","classes","capacity","flow","length","Math","sqrt","pow","pos","middle","orientation","atan","PI","angle","red","rgb","map","gCh","i","style","backgroundColor","join","className","makeStyles","theme","label","marginTop","spacing","FlowNode","draggable","onClick","e","preventDefault","stopPropagation","id","onDrag","event","onDragStart","img","Image","src","dataTransfer","setDragImage","positionY","positionX","bgColor","SmartButton","disabled","otherProps","Button","variant","children","canvas","useMUIStyles","root","margin","grow","flexGrow","absoluteCoordinate","normalizedCoordinate","absolutePosition","normalizedPosition","window","innerWidth","innerHeight","relativePosition","reducer","state","action","type","ADD_NODE","nodes","payload","REMOVE_NODE","arcs","Object","values","selectedNode","undefined","source","sink","ADD_ARC","from","to","MOVE_NODE","SET_SOURCE","SET_SINK","SELECT_NODE","FlowNetworkEditor","useState","setFlow","useReducer","dispatch","dragHandler","useCallback","clientX","clientY","canvasClickHandler","Date","now","nodeClickHandler","useMemo","round","random","runClickHandler","Promise","resolve","arcsWithBackward","keys","reduce","acc","findPath","node","visited","increase","newVisited","path","dest","find","currentFlow","arcIncrease","min","entries","augmentingPath","Infinity","forward","fordFulkerson","then","deleteClickHandler","sourceMarkClickHandler","sinkMarkClickHandler","muiClasses","Bar","AppBar","Toolbar","ButtonGroup","startIcon","color","flat","App","document","addEventListener","ReactDOM","render","StrictMode","getElementById"],"mappings":"mTAAO,SAASA,EAASC,GACvB,OAAOA,EAAQ,KCIjB,IC+DKC,ED/DCC,EAAYC,YAAgB,CAChCC,SAAU,CACRC,SAAU,WACVC,IAAK,QAEPC,MAAO,CACLC,QAAS,eACTH,SAAU,WACVC,IAAK,OACLG,KAAM,OACNC,OAAQ,cACRC,YAAY,eACZC,MAAO,MACPC,OAAQ,MACRC,UAAW,oBAIFC,EAAUC,gBAAK,SAACC,GAS3B,IEfgBC,EAAUC,EHdHC,EC6BjBC,EAAQ,CAACC,EAAGL,EAAMM,OAAQC,EAAGP,EAAMQ,QACnCC,EAAM,CAACJ,EAAGL,EAAMU,KAAMH,EAAGP,EAAMW,MAC/BC,EAAU3B,IACR4B,EAAmBb,EAAnBa,SAAUC,EAASd,EAATc,KACZC,GEnBUd,EFmBQG,EEnBEF,EFmBKO,EElBxBO,KAAKC,KAAKD,KAAKE,IAAIjB,EAAEI,EAAIH,EAAEG,EAAG,GAAKW,KAAKE,IAAIjB,EAAEM,EAAIL,EAAEK,EAAG,KFmBxDY,EEhBR,SAAgBlB,EAAUC,GACxB,MAAO,CACLG,GAAIJ,EAAEI,EAAIH,EAAEG,GAAK,EACjBE,GAAIN,EAAEM,EAAIL,EAAEK,GAAK,GFaPa,CAAOhB,EAAOK,GACpBY,EEVR,SAAepB,EAAUC,GACvB,OAAOc,KAAKM,MAAMpB,EAAEK,EAAIN,EAAEM,IAAML,EAAEG,EAAIJ,EAAEI,KAAQH,EAAEG,EAAIJ,EAAEI,EAAIW,KAAKO,GAAK,GFSlDC,CAAMpB,EAAOK,GAG3BgB,EAAM,CAAC,IAAK,EAAG,GACfC,EAFQ,CAAC,EAAG,IAAK,GAELC,KAAI,SAACC,EAAKC,GAAN,OAAYD,GAAOH,EAAII,GAAKD,GAAOd,EAAOD,KAC1DiB,EAAQ,CACZzC,IAAKP,EAASqC,EAAIZ,GAClBf,KAAMV,EAASqC,EAAId,GACnBV,MAAOb,EAASiC,GAChBlB,UAAW,sBAAekB,EAAS,EAAxB,QD5CUZ,EC4CgCkB,ED3CjD,UAAN,OAAiBlB,EAAjB,SC4CE4B,gBAAgB,OAAD,OAASL,EAAIM,KAAK,KAAlB,MAGjB,OAAO,sBAAKC,UAAU,WAAWH,MAAOA,EAAjC,UACL,mBAAGG,UAAWrB,EAAQtB,QACtB,uBAAM2C,UAAWrB,EAAQzB,SAAzB,UAAoC2B,EAApC,IAA2CD,WG/CzC5B,EAAYiD,aAAW,SAACC,GAAD,MAAY,CACvCC,MAAO,CAEL7C,QAAS,eACT8C,UAAWF,EAAMG,QAAQ,QAIhBC,EAAWxC,gBAAK,SAACC,GAS5B,IAAMY,EAAU3B,IAOhB,OACE,sBACEgD,UAAU,YACVO,WAAW,EACXC,QAAS,SAACC,GACRA,EAAEC,iBACFD,EAAEE,kBACF5C,EAAMyC,QAAQzC,EAAM6C,KAEtBC,OAAQ,SAACC,GAAD,OAAW/C,EAAM8C,OAAO9C,EAAM6C,GAAIE,IAC1CC,YAfqB,SAACD,GACxB,IAAIE,EAAM,IAAIC,MACdD,EAAIE,IAAM,yEACVJ,EAAMK,aAAaC,aAAaJ,EAAK,EAAG,IAatCnB,MACE,CACEzC,IAAKP,EAASkB,EAAMsD,WACpB9D,KAAMV,EAASkB,EAAMuD,WACrBxB,gBAAiB/B,EAAMwD,SAd7B,UAgBGxD,EAAM6C,GACP,sBAAMZ,UAAWrB,EAAQwB,MAAzB,SACGpC,EAAMoC,c,QC7CFqB,EAAc1D,gBAAK,SAACC,GACcA,EAApCyC,QAAoCzC,EAA3B0D,SAD6D,IAChDC,EAD+C,YACjC3D,EADiC,wBAE5E,OAAO,cAAC4D,EAAA,EAAD,yBACHC,QAAQ,YACRpB,QAASzC,EAAMyC,QACfiB,UAAW1D,EAAMyC,SACbkB,GAJD,aAMF3D,EAAM8D,e,oEHET7E,EAAYC,YAAgB,CAChC6E,OAAQ,CACNpE,MAAO,OACPC,OAAQ,WAINoE,EAAe9B,aAAW,SAACC,GAAD,MAAY,CAC1C8B,KAAM,CACJ,QAAS,CACPC,OAAQ/B,EAAMG,QAAQ,KAG1B6B,KAAM,CACJC,SAAU,OAmBd,SAASC,EAAmBC,EAA8BvD,GACxD,OAAQA,EAASuD,EAAuBvD,GAAU,EAEpD,SAASuD,EAAqBD,EAA4BtD,GACxD,OAA6B,EAArBsD,EAAyBtD,GAAUA,EAG7C,SAASwD,EAAiBC,GACxB,MAAO,CACLnE,EAAGgE,EAAmBG,EAAmBnE,EAAGoE,OAAOC,YACnDnE,EAAG8D,EAAmBG,EAAmBjE,EAAGkE,OAAOE,cAIvD,SAASC,EAAiBL,GACxB,MAAO,CACLlE,EAAGiE,EAAqBC,EAAiBlE,EAAGoE,OAAOC,YACnDnE,EAAG+D,EAAqBC,EAAiBhE,EAAGkE,OAAOE,cAiCvD,SAASE,EAAQC,EAAoBC,GACnC,OAAQA,EAAOC,MACb,KAAKhG,EAAeiG,SAClB,OAAO,2BACFH,GADL,IAEEI,MAAM,2BACDJ,EAAMI,OADN,kBAEFH,EAAOI,QAAQtC,GAAKkC,EAAOI,YAGlC,KAAKnG,EAAeoG,YAKlB,IALF,MACkDN,EAAMI,MADxD,EACWH,EAAOI,QAAsBD,GADxC,oCAE6DJ,EAAMO,KAFnE,EAEWN,EAAOI,QAAkCE,GAFpD,kCAKE,MAAkBC,OAAOC,OAAOF,GAAhC,eAAuC,QAAzB,KACDN,EAAOI,SAEpB,OAAO,2BACFL,GADL,IAEEO,OACAH,QACAM,aAAcT,EAAOI,UAAYL,EAAMU,aAAeV,EAAMU,kBAAeC,EAC3EC,OAAQX,EAAOI,UAAYL,EAAMY,OAASZ,EAAMY,YAASD,EACzDE,KAAMZ,EAAOI,UAAYL,EAAMa,KAAOb,EAAMY,YAASD,IAEzD,KAAKzG,EAAe4G,QAClB,OAAO,2BACFd,GADL,IAEEU,kBAAcC,EACdJ,KAAK,2BACAP,EAAMO,MADP,kBAEDN,EAAOI,QAAQU,KAFd,2BAGGf,EAAMO,KAAKN,EAAOI,QAAQU,OAH7B,kBAICd,EAAOI,QAAQW,GAAKf,EAAOI,QAAQtE,eAI5C,KAAK7B,EAAe+G,UAClB,OAAO,2BACFjB,GADL,IAEEI,MAAM,2BACDJ,EAAMI,OADN,kBAEFH,EAAOI,QAAQtC,GAFb,2BAGEiC,EAAMI,MAAMH,EAAOI,QAAQtC,KAH7B,IAIDzD,SAAU2F,EAAOI,QAAQ/F,eAIjC,KAAKJ,EAAegH,WAClB,OAAO,2BACFlB,GADL,IAEEU,kBAAcC,EACdC,OAAQX,EAAOI,UAEnB,KAAKnG,EAAeiH,SAClB,OAAO,2BACFnB,GADL,IAEEU,kBAAcC,EACdE,KAAMZ,EAAOI,UAEjB,KAAKnG,EAAekH,YAClB,OAAO,2BACFpB,GADL,IAEEU,aAAcT,EAAOI,UAAYL,EAAMU,aAAeT,EAAOI,aAAUM,IAE3E,QACE,OAAOX,GAMN,SAASqB,IAAqB,IAAD,EAEVC,mBAA6B,IAFnB,mBAE3BtF,EAF2B,KAErBuF,EAFqB,OAGLD,mBAAS,IAHJ,uBAKRE,qBAAWzB,EAAS,CAC5CK,MAAO,GACPG,KAAM,GACNvE,KAAM,MAR0B,mBAK3BgE,EAL2B,KAKpByB,EALoB,KAW1BZ,EAA+Bb,EAA/Ba,KAAMD,EAAyBZ,EAAzBY,OAAQF,EAAiBV,EAAjBU,aAChBgB,EAAcC,uBAAY,SAAC5D,EAAIE,GAEnCA,EAAMJ,iBACN,IAAMvD,EAAWwF,EAAiB,CAAEvE,EAAG0C,EAAM2D,QAASnG,EAAGwC,EAAM4D,UAE/DJ,EAAS,CACPvB,KAAMhG,EAAe+G,UACrBZ,QAAS,CACPtC,KACAzD,gBAIH,IAEGwH,EAAqBH,uBAAY,SAAC/D,GACtC6D,EAAS,CACPvB,KAAMhG,EAAeiG,SACrBE,QAAS,CACPtC,GAAI,GAAKgE,KAAKC,MACd1H,SAAUwF,EAAiB,CAAEvE,EAAGqC,EAAEgE,QAASnG,EAAGmC,EAAEiE,eAGnD,IAGGI,EAAmBC,mBAAQ,WAC/B,OAAO,SAACnE,GAAgB,IAAD,IAEhB2C,GAAgB3C,IAAO2C,GASxB,UAACV,EAAMO,KAAKG,UAAZ,aAAC,EAA2B3C,MAAO,UAACiC,EAAMO,KAAKxC,UAAZ,aAAC,EAAiB2C,KACvDe,EAAS,CACPvB,KAAMhG,EAAe4G,QACrBT,QAAS,CACPU,KAAML,EACNM,GAAIjD,EACJhC,SAAUG,KAAKiG,MAAM,EAAIjG,KAAKkG,UAAY,KAd9CX,EAAS,CACPvB,KAAMhG,EAAekH,YACrBf,QAAStC,OAiBd,CAAC2C,EAAcV,EAAMO,OAElB8B,EAAkBH,mBAAQ,WAC9B,OAAOtB,GAAUC,EAAO,WACtB,IAAIyB,SAA4B,SAACC,GAE/BA,EI3OD,SAAuB3B,EAAgBC,EAAcN,GAE1D,IAAMvE,EAAa,GAEbwG,EAAmBhC,OAAOiC,KAAKlC,GAAMmC,QAAa,SAACC,EAAK3B,GAC5D,cAAmBR,OAAOiC,KAAKlC,EAAKS,IAApC,eAA0C,CAArC,IAAMD,EAAI,KACR4B,EAAI5B,KACP4B,EAAI5B,GAAQ,IAET4B,EAAI3B,KACP2B,EAAI3B,GAAM,IAEZ2B,EAAI3B,GAAID,GAAQR,EAAKS,GAAID,GAEzB4B,EAAI5B,GAAMC,IAAO2B,EAAI3B,GAAID,GAE3B,OAAO4B,IACN,IAEH,SAASC,EAASC,EAAcC,EAAmBC,GACjD,IAAMC,EAAU,sBAAOF,GAAP,CAAgBD,IAEhC,GAAIA,IAAShC,EAEX,MAAO,CACLiC,QAASE,EACTD,YAKJ,IADA,IAAIE,EAAO,KAXwG,2CAYvGC,EAZuG,KAYjGnH,EAZiG,KAcjH,GAAI+G,EAAQK,MAAK,SAACvF,GAAD,OAAOA,IAAMsF,KAC5B,iBAGF,IAAME,EAAW,oBAAGpH,EAAK6G,UAAR,aAAG,EAAaK,UAAhB,QAAyB,EAGpCG,EAActH,GAAY,EAAIA,EAAWqH,EAAcA,EAE7D,OAAIC,EAAc,IAChBJ,EAAOL,EAASM,EAAMF,EAAY9G,KAAKoH,IAAIP,EAAUM,KAGnD,aAJJ,GAXF,MAA+B7C,OAAO+C,QAAP,UAAef,EAAiBK,UAAhC,QAAyC,IAAxE,eAA6E,CAAC,IAAD,uCAevE,MAKN,OAAOI,EAIT,IADA,IAAIO,EAAiBZ,EAAShC,EAAQ,GAAI6C,KACnCD,GAAgB,CAErB,IAFsB,IAAD,EACfV,EAAO,UAAGU,SAAH,aAAG,EAAgBV,QACvB/F,EAAI,EAAGA,EAAI+F,EAAQ7G,OAAS,EAAGc,IAAK,CAAC,IAAD,EAC5B,CAAC+F,EAAQ/F,GAAI+F,EAAQ/F,EAAI,IAAjC5B,EADoC,KACjCC,EADiC,KAEtCY,EAAKb,KACRa,EAAKb,GAAK,IAGZ,IAAMuI,IAAYnD,EAAKpF,GAAGC,GACpBiI,EAAcG,EAAeT,UAAYW,EAAU,GAAK,GAPnB,EASxBA,EAAU,CAACvI,EAAGC,GAAK,CAACA,EAAGD,GATC,mBASpC4F,EAToC,KAS9BC,EAT8B,KAWtChF,EAAK+E,GAAMC,GAGdhF,EAAK+E,GAAMC,IAAOqC,EAFlBrH,EAAK+E,GAAMC,GAAMqC,EAMrBG,EAAiBZ,EAAShC,EAAQ,GAAI6C,KAGxC,OAAOzH,EJ4JY2H,CAAc/C,EAAQC,EAAMb,EAAMO,UAE9CqD,KAAKrC,SACNZ,IAEJ,CAACX,EAAMO,KAAMK,EAAQC,IAEjBgD,EAAqB3B,mBAAQ,WACjC,OAAOxB,EAAe,WAEpBe,EAAS,CACPvB,KAAMhG,EAAeoG,YACrBD,QAASK,UAGTC,IAEJ,CAACD,IAEGoD,EAAyB5B,mBAAQ,WACrC,OAAOxB,GAAgBA,IAAiBG,EAAO,WAC7CY,EAAS,CACPvB,KAAMhG,EAAegH,WACrBb,QAASK,IAAiBE,EAASF,OAAeC,UAElDA,IAEJ,CAACD,EAAcG,EAAMD,IAGjBmD,EAAuB7B,mBAAQ,WACnC,OAAOxB,GAAgBA,IAAiBE,EAAS,WAC/Ca,EAAS,CACPvB,KAAMhG,EAAeiH,SACrBd,QAASK,IAAiBG,EAAOH,OAAeC,UAEhDA,IAEJ,CAACD,EAAcG,EAAMD,IAIjB9E,EAAU3B,IACV6J,EAAa9E,IAEb+E,EAAM/B,mBAAQ,kBAAM,cAACgC,EAAA,EAAD,CAAQ5J,SAAS,QAAjB,SACxB,eAAC6J,EAAA,EAAD,CAAShH,UAAW6G,EAAW7E,KAA/B,UACE,qBAAMhC,UAAW6G,EAAW3E,OAC5B,eAAC+E,EAAA,EAAD,CAAarF,QAAQ,YAArB,UACE,eAACJ,EAAD,CAAahB,QAASmG,EAAwBO,UAAW,cAAC,IAAD,IAAzD,UAAyE3D,IAAiBE,EAAS,MAAQ,IAA3G,mBACA,eAACjC,EAAD,CAAahB,QAASoG,EAAsBM,UAAW,cAAC,IAAD,IAAvD,UAAsE3D,IAAiBG,EAAO,MAAQ,IAAtG,iBACA,cAAClC,EAAD,CAAahB,QAASkG,EAAoBQ,UAAW,cAAC,IAAD,IAArD,uBAEF,cAAC1F,EAAD,CAAahB,QAAS0E,EAAiBiC,MAAM,UAAUvF,QAAQ,YAAYsF,UAAW,cAAC,IAAD,IAAtF,4BAGF,CAACP,EAAwBC,EAAsB1B,EAAiBwB,EAAoBjD,EAAQC,EAAMH,EAAcsD,IAGlH,OAAO,qCACJC,EACD,sBAAKtG,QAASmE,EAAoB3E,UAAWrB,EAAQmD,OAArD,UAEIuB,OAAOC,OAAOT,EAAMI,OAAOvD,KAAI,SAAAgG,GAC7B,IAAMxG,EAAMoD,EAAiBoD,EAAKvI,UAClC,OAAO,cAAC,EAAD,yBAEL0D,OAAQ0D,EACR/D,QAAS,kBAAMsE,EAAiBY,EAAK9E,MACjC8E,GAJC,IAKLpE,UAAWpC,EAAId,EACfiD,UAAWnC,EAAIZ,EACfiD,QAASmE,EAAK9E,KAAO2C,EAAe,WAAQC,EAC5CrD,MAAOuD,IAASgC,EAAK9E,GAAK,cAAC,IAAD,IAAgB6C,IAAWiC,EAAK9E,GAAK,cAAC,IAAD,SAAgB4C,IAP1EkC,EAAK9E,OAYdyC,OAAOiC,KAAKzC,EAAMO,MAAM1D,KAAI,SAAAkE,GAAI,OAAIP,OAAOiC,KAAKzC,EAAMO,KAAKQ,IAAOlE,KAAI,SAAAmE,GAAO,IAAD,EACpE1F,EAAQmE,EAAiBO,EAAMI,MAAMW,GAAMzG,UAC3CqB,EAAM8D,EAAiBO,EAAMI,MAAMY,GAAI1G,UAC7C,OAAO,cAACU,EAAD,CAELgB,MAAM,UAAAA,EAAK+E,UAAL,eAAaC,KAAO,EAC1BjF,SAAUiE,EAAMO,KAAKQ,GAAMC,GAC3BxF,OAAQF,EAAMC,EACdG,OAAQJ,EAAMG,EACdG,KAAMD,EAAIJ,EACVM,KAAMF,EAAIF,GANLsF,EAAO,IAAMC,SAQlBuD,c,SAlQPrK,O,uBAAAA,I,6BAAAA,I,yBAAAA,I,qBAAAA,I,2BAAAA,I,uBAAAA,I,8BAAAA,M,KK1DUsK,MAPf,WAEE,OACE,cAACnD,EAAD,KCDJoD,SAASC,iBAAiB,YAAY,SAAUzG,GAG9CA,EAAMJ,oBAEL,GAEH8G,IAASC,OACP,cAAC,IAAMC,WAAP,UACE,cAAC,EAAD,MAEFJ,SAASK,eAAe,W","file":"static/js/main.93aa01a6.chunk.js","sourcesContent":["export function asPixels(value: number) {\n  return value + 'px'\n}\nexport function cssAngle(rad: number) {\n  return `rotate(${rad}rad)`\n}","import React, { memo } from 'react'\nimport { angle, distance, middle } from '../../geometry/index';\nimport { asPixels, cssAngle } from '../../utils/index';\nimport { createUseStyles } from 'react-jss'\n\nconst useStyles = createUseStyles({\n  arcLabel: {\n    position: 'absolute',\n    top: '10px'\n  },\n  arrow: {\n    display: 'inline-block',\n    position: 'absolute',\n    top: '-2px',\n    left: '20px',\n    border: 'solid black',\n    borderWidth:' 0 3px 3px 0',\n    width: '6px',\n    height: '6px',\n    transform: 'rotate(-45deg)',\n  },\n})\n\nexport const FlowArc = memo((props: {\n  startX: number,\n  startY: number,\n  endX: number,\n  endY: number,\n  capacity: number\n  flow: number\n}) => {\n\n  const start = {x: props.startX, y: props.startY}\n  const end = {x: props.endX, y: props.endY}\n  const classes = useStyles()\n  const { capacity, flow } = props\n  const length = distance(start, end)\n  const pos = middle(start, end)\n  const orientation = angle(start, end)\n\n  const green = [0, 255, 0]\n  const red = [255, 0, 0]\n  const rgb = green.map((gCh, i) => gCh + (red[i] - gCh) * flow / capacity)\n  const style = {\n    top: asPixels(pos.y),\n    left: asPixels(pos.x),\n    width: asPixels(length),\n    transform: `translateX(${-length / 2}px)` + cssAngle(orientation),\n    backgroundColor: `rgb(${rgb.join(',')})`\n  }\n\n  return <div className='flow-arc' style={style}>\n    <i className={classes.arrow} />\n    <span className={classes.arcLabel}>{flow}/{capacity}</span>\n  </div>\n})","import { AppBar, ButtonGroup, makeStyles, Toolbar } from \"@material-ui/core\";\n\nimport { memo, useCallback, useMemo, useReducer, useState } from \"react\";\nimport { createUseStyles } from \"react-jss\";\nimport { Point } from \"../../geometry\";\nimport { fordFulkerson } from \"../../maxflow\";\nimport { FlowArc, FlowNetworkNode } from \"../flow\";\nimport { NodeId, NumericLabeledArcs } from \"../types\";\nimport { SmartButton } from \"./SmartButton\";\nimport FlagIcon from '@material-ui/icons/Flag';\nimport PlayArrowIcon from \"@material-ui/icons/PlayArrow\";\nimport InputIcon from '@material-ui/icons/Input';\nimport DeleteIcon from '@material-ui/icons/Delete';\n\nconst useStyles = createUseStyles({\n  canvas: {\n    width: '100%',\n    height: '100vh',\n  }\n})\n\nconst useMUIStyles = makeStyles((theme) => ({\n  root: {\n    '& > *': {\n      margin: theme.spacing(1),\n    },\n  },\n  grow: {\n    flexGrow: 1,\n  },\n}));\n\nclass Node<T>{\n  private id: NodeId\n  public value: T\n\n  constructor(id: NodeId, value: T) {\n    this.id = id;\n    this.value = value\n  }\n}\n\ntype NodeData = {\n  id: string,\n  position: Point,\n}\n\nfunction absoluteCoordinate(normalizedCoordinate: number, length: number) {\n  return (length + normalizedCoordinate * length) / 2\n}\nfunction normalizedCoordinate(absoluteCoordinate: number, length: number) {\n  return (absoluteCoordinate * 2 - length) / length\n}\n\nfunction absolutePosition(normalizedPosition: Point) {\n  return {\n    x: absoluteCoordinate(normalizedPosition.x, window.innerWidth),\n    y: absoluteCoordinate(normalizedPosition.y, window.innerHeight),\n  }\n}\n\nfunction relativePosition(absolutePosition: Point) {\n  return {\n    x: normalizedCoordinate(absolutePosition.x, window.innerWidth),\n    y: normalizedCoordinate(absolutePosition.y, window.innerHeight),\n  }\n}\n\nenum EDITOR_ACTIONS {\n  ADD_NODE,\n  REMOVE_NODE,\n  MOVE_NODE,\n  ADD_ARC,\n  SET_SOURCE,\n  SET_SINK,\n  SELECT_NODE\n}\n\ntype Action =\n  { type: EDITOR_ACTIONS.ADD_NODE, payload: NodeData }\n  | { type: EDITOR_ACTIONS.REMOVE_NODE, payload: NodeId }\n  | { type: EDITOR_ACTIONS.MOVE_NODE, payload: { id: NodeId, position: Point } }\n  | { type: EDITOR_ACTIONS.ADD_ARC, payload: { from: NodeId, to: NodeId, capacity: number } }\n  | { type: EDITOR_ACTIONS.SET_SOURCE, payload: NodeId | undefined }\n  | { type: EDITOR_ACTIONS.SET_SINK, payload: NodeId | undefined }\n  | { type: EDITOR_ACTIONS.SELECT_NODE, payload: NodeId }\n\n\ntype EditorState = {\n  nodes: { [id: string]: NodeData }\n  arcs: NumericLabeledArcs\n  flow: NumericLabeledArcs\n  source?: NodeId\n  sink?: NodeId\n  selectedNode?: NodeId\n}\n\nfunction reducer(state: EditorState, action: Action): EditorState {\n  switch (action.type) {\n    case EDITOR_ACTIONS.ADD_NODE:\n      return {\n        ...state,\n        nodes: {\n          ...state.nodes,\n          [action.payload.id]: action.payload\n        }\n      }\n    case EDITOR_ACTIONS.REMOVE_NODE:\n      const { [action.payload]: deleted, ...nodes } = state.nodes\n      const { [action.payload]: arcsFromRemovedNode, ...arcs } = state.arcs\n\n      //remove the ingoing arcs to the node\n      for (const tos of Object.values(arcs)) {\n        delete tos[action.payload]\n      }\n      return {\n        ...state,\n        arcs,\n        nodes,\n        selectedNode: action.payload !== state.selectedNode ? state.selectedNode : undefined,\n        source: action.payload !== state.source ? state.source : undefined,\n        sink: action.payload !== state.sink ? state.source : undefined,\n      }\n    case EDITOR_ACTIONS.ADD_ARC:\n      return {\n        ...state,\n        selectedNode: undefined,\n        arcs: {\n          ...state.arcs,\n          [action.payload.from]: {\n            ...state.arcs[action.payload.from],\n            [action.payload.to]: action.payload.capacity\n          }\n        },\n      }\n    case EDITOR_ACTIONS.MOVE_NODE:\n      return {\n        ...state,\n        nodes: {\n          ...state.nodes,\n          [action.payload.id]: {\n            ...state.nodes[action.payload.id],\n            position: action.payload.position\n          }\n        }\n      }\n    case EDITOR_ACTIONS.SET_SOURCE:\n      return {\n        ...state,\n        selectedNode: undefined,\n        source: action.payload\n      }\n    case EDITOR_ACTIONS.SET_SINK:\n      return {\n        ...state,\n        selectedNode: undefined,\n        sink: action.payload\n      }\n    case EDITOR_ACTIONS.SELECT_NODE:\n      return {\n        ...state,\n        selectedNode: action.payload !== state.selectedNode ? action.payload : undefined\n      }\n    default:\n      return state\n\n  }\n}\n\n\nexport function FlowNetworkEditor() {\n\n  const [flow, setFlow] = useState<NumericLabeledArcs>({})\n  const [defaultArcCapacity] = useState(10)\n\n  const [state, dispatch] = useReducer(reducer, {\n    nodes: {},\n    arcs: {},\n    flow: {},\n  })\n\n  const { sink, source, selectedNode } = state\n  const dragHandler = useCallback((id, event) => {\n\n    event.preventDefault()\n    const position = relativePosition({ x: event.clientX, y: event.clientY })\n\n    dispatch({\n      type: EDITOR_ACTIONS.MOVE_NODE,\n      payload: {\n        id,\n        position\n      }\n    })\n\n  }, [])\n\n  const canvasClickHandler = useCallback((e: React.MouseEvent) => {\n    dispatch({\n      type: EDITOR_ACTIONS.ADD_NODE,\n      payload: {\n        id: '' + Date.now(),\n        position: relativePosition({ x: e.clientX, y: e.clientY })\n      }\n    })\n  }, [])\n\n\n  const nodeClickHandler = useMemo(() => {\n    return (id: NodeId) => {\n\n      if (!selectedNode || id === selectedNode) {\n        dispatch({\n          type: EDITOR_ACTIONS.SELECT_NODE,\n          payload: id\n        })\n        return\n      }\n\n      //we add the new arc\n      if (!state.arcs[selectedNode]?.[id] && !state.arcs[id]?.[selectedNode]) {\n        dispatch({\n          type: EDITOR_ACTIONS.ADD_ARC,\n          payload: {\n            from: selectedNode,\n            to: id,\n            capacity: Math.round(8 * Math.random()) + 2\n          }\n        })\n      }\n    }\n  }, [selectedNode, state.arcs])\n\n  const runClickHandler = useMemo(() => {\n    return source && sink ? () => {\n      new Promise<NumericLabeledArcs>((resolve) => {\n        const flow = fordFulkerson(source, sink, state.arcs)\n        resolve(flow)\n      }).then(setFlow)\n    } : undefined\n  },\n    [state.arcs, source, sink])\n\n  const deleteClickHandler = useMemo(() => {\n    return selectedNode ? () => {\n      //remove the node\n      dispatch({\n        type: EDITOR_ACTIONS.REMOVE_NODE,\n        payload: selectedNode,\n      })\n\n    } : undefined\n  },\n    [selectedNode])\n\n  const sourceMarkClickHandler = useMemo(() => {\n    return selectedNode && selectedNode !== sink ? () => {\n      dispatch({\n        type: EDITOR_ACTIONS.SET_SOURCE,\n        payload: selectedNode !== source ? selectedNode : undefined,\n      })\n    } : undefined\n  },\n    [selectedNode, sink, source]\n  )\n\n  const sinkMarkClickHandler = useMemo(() => {\n    return selectedNode && selectedNode !== source ? () => {\n      dispatch({\n        type: EDITOR_ACTIONS.SET_SINK,\n        payload: selectedNode !== sink ? selectedNode : undefined,\n      })\n    } : undefined\n  },\n    [selectedNode, sink, source]\n  )\n\n\n  const classes = useStyles()\n  const muiClasses = useMUIStyles()\n\n  const Bar = useMemo(() => <AppBar position=\"fixed\">\n    <Toolbar className={muiClasses.root}>\n      <div  className={muiClasses.grow}/>\n      <ButtonGroup variant='contained' >\n        <SmartButton onClick={sourceMarkClickHandler} startIcon={<InputIcon />}>{selectedNode === source ? 'Unm' : 'M'}ark as source</SmartButton>\n        <SmartButton onClick={sinkMarkClickHandler} startIcon={<FlagIcon />}>{selectedNode === sink ? 'Unm' : 'M'}ark as sink</SmartButton>\n        <SmartButton onClick={deleteClickHandler} startIcon={<DeleteIcon />}>Delete</SmartButton>\n      </ButtonGroup>\n      <SmartButton onClick={runClickHandler} color='primary' variant='contained' startIcon={<PlayArrowIcon />}>Compute</SmartButton>\n    </Toolbar>\n  </AppBar>,\n    [sourceMarkClickHandler, sinkMarkClickHandler, runClickHandler, deleteClickHandler, source, sink, selectedNode, muiClasses])\n\n\n  return <>\n    {Bar}\n    <div onClick={canvasClickHandler} className={classes.canvas}>\n      {\n        Object.values(state.nodes).map(node => {\n          const pos = absolutePosition(node.position)\n          return <FlowNetworkNode\n            key={node.id}\n            onDrag={dragHandler}\n            onClick={() => nodeClickHandler(node.id)}\n            {...node}\n            positionX={pos.x}\n            positionY={pos.y}\n            bgColor={node.id === selectedNode ? 'red' : undefined}\n            label={sink === node.id ? <FlagIcon /> : (source === node.id ? <InputIcon /> : undefined)}\n          />\n        })\n      }\n      {\n        Object.keys(state.arcs).map(from => Object.keys(state.arcs[from]).map(to => {\n          const start = absolutePosition(state.nodes[from].position)\n          const end = absolutePosition(state.nodes[to].position)\n          return <FlowArc\n            key={from + '-' + to}\n            flow={flow[from]?.[to] || 0}\n            capacity={state.arcs[from][to]}\n            startX={start.x}\n            startY={start.y}\n            endX={end.x}\n            endY={end.y}\n          />\n        })).flat()\n      }\n    </div>\n  </>\n\n}","\nexport type Point = {\n  x: number;\n  y: number;\n}\nexport type RectangleSize = {\n  width: number\n  height: number\n}\n\nfunction randomPoint(): Point {\n  function randomCoordinate() {\n    return -1 + Math.random() * 2\n  }\n  return { x: randomCoordinate(), y: randomCoordinate() }\n}\n\nfunction distance(a: Point, b: Point) {\n  return Math.sqrt(Math.pow(a.x - b.x, 2) + Math.pow(a.y - b.y, 2))\n}\n\nfunction middle(a: Point, b: Point) {\n  return {\n    x: (a.x + b.x) / 2,\n    y: (a.y + b.y) / 2,\n  }\n}\n\nfunction angle(a: Point, b: Point) {\n  return Math.atan((b.y - a.y) / (b.x - a.x)) + ( b.x < a.x ? Math.PI : 0)\n}\n\nfunction absolutePosition(position: Point): Point {\n  return {\n    x: 250 + position.x * 250,\n    y: 250 + position.y * 250\n  }\n}\n\nexport {\n  distance,\n  middle,\n  angle,\n  randomPoint,\n  absolutePosition\n}","import { makeStyles } from \"@material-ui/core\";\nimport React, { DragEvent, memo } from \"react\"\n\nimport { asPixels } from '../../utils/index';\nimport { NodeId } from \"../types\";\n\nconst useStyles = makeStyles((theme) => ({\n  label: {\n\n    display: 'inline-block',\n    marginTop: theme.spacing(1)\n  },\n}));\n\nexport const FlowNode = memo((props: {\n  id: NodeId\n  positionX: number,\n  positionY: number,\n  onClick: (id: NodeId) => void\n  onDrag: (id: NodeId, event: DragEvent) => void\n  bgColor?: string\n  label?: React.ReactNode\n}) => {\n  const classes = useStyles()\n\n  const dragStartHandler = (event: DragEvent) => {\n    var img = new Image();\n    img.src = 'data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=';\n    event.dataTransfer.setDragImage(img, 0, 0);\n  }\n  return (\n    <div\n      className='flow-node'\n      draggable={true}\n      onClick={(e) => {\n        e.preventDefault()\n        e.stopPropagation()\n        props.onClick(props.id)\n      }}\n      onDrag={(event) => props.onDrag(props.id, event)}\n      onDragStart={dragStartHandler}\n      style={\n        {\n          top: asPixels(props.positionY),\n          left: asPixels(props.positionX),\n          backgroundColor: props.bgColor,\n        }}>\n      {props.id}\n      <span className={classes.label}>\n        {props.label}\n      </span>\n    </div>\n  )\n})\n\n\n","import { Button } from \"@material-ui/core\";\r\nimport { memo } from \"react\";\r\n\r\n\r\nexport const SmartButton = memo((props: React.ComponentProps<typeof Button>) => {\r\n    const {onClick, disabled, ...otherProps} = props\r\n    return <Button\r\n        variant='contained'\r\n        onClick={props.onClick}\r\n        disabled={!props.onClick}\r\n        {...otherProps}\r\n        >\r\n        {props.children}\r\n    </Button>\r\n})","type Arcs = { [from: string]: { [to: string]: number } }\r\n\r\nexport function fordFulkerson(source: string, sink: string, arcs: Arcs) {\r\n\r\n  const flow: Arcs = {}\r\n\r\n  const arcsWithBackward = Object.keys(arcs).reduce<Arcs>((acc, to) => {\r\n    for (const from of Object.keys(arcs[to])) {\r\n      if (!acc[from]) {\r\n        acc[from] = {}\r\n      }\r\n      if (!acc[to]) {\r\n        acc[to] = {}\r\n      }\r\n      acc[to][from] = arcs[to][from]\r\n      //mark backwards with negative capacity\r\n      acc[from][to] = -acc[to][from]\r\n    }\r\n    return acc\r\n  }, {})\r\n\r\n  function findPath(node: string, visited: string[], increase: number): { visited: string[], increase: number } | null {\r\n    const newVisited = [...visited, node]\r\n\r\n    if (node === sink) {\r\n      //we have arrived\r\n      return {\r\n        visited: newVisited,\r\n        increase\r\n      }\r\n    }\r\n\r\n    let path = null\r\n    for (const [dest, capacity] of Object.entries(arcsWithBackward[node] ?? {})) {\r\n\r\n      if (visited.find((e) => e === dest)) {\r\n        continue\r\n      }\r\n\r\n      const currentFlow = flow[node]?.[dest] ?? 0\r\n\r\n      //if capacity is negative we are looking at a backward arc\r\n      const arcIncrease = capacity >= 0 ? capacity - currentFlow : currentFlow\r\n\r\n      if (arcIncrease > 0) {\r\n        path = findPath(dest, newVisited, Math.min(increase, arcIncrease))\r\n        //we got a path\r\n        if (path) {\r\n          break\r\n        }\r\n      }\r\n    }\r\n\r\n    return path\r\n  }\r\n\r\n  let augmentingPath = findPath(source, [], Infinity)\r\n  while (augmentingPath) {\r\n    const visited = augmentingPath?.visited\r\n    for (let i = 0; i < visited.length - 1; i++) {\r\n      const [a, b] = [visited[i], visited[i + 1]]\r\n      if (!flow[a]) {\r\n        flow[a] = {}\r\n      }\r\n      //check if it was a backward arc\r\n      const forward = !!arcs[a][b]\r\n      const arcIncrease = augmentingPath.increase * (forward ? 1 : -1)\r\n\r\n      const [from, to] = forward ? [a, b] : [b, a]\r\n\r\n      if (!flow[from][to]) {\r\n        flow[from][to] = arcIncrease\r\n      } else {\r\n        flow[from][to] += arcIncrease\r\n      }\r\n    }\r\n\r\n    augmentingPath = findPath(source, [], Infinity)\r\n  }\r\n\r\n  return flow\r\n}","import './App.css'\nimport { FlowNetworkEditor } from './components/FlowNetworkEditor';\n\nfunction App() {\n\n  return (\n    <FlowNetworkEditor />\n  )\n}\n\nexport default App","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\ndocument.addEventListener('dragover', function (event) {\n\n  // prevent default to allow drop\n  event.preventDefault();\n\n}, false);\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n"],"sourceRoot":""}