{"version":3,"sources":["utils/sleep.ts","maxflow/FordFulkerson.tsx","utils/index.tsx","components/flow/FlowArc.tsx","components/FlowNetworkEditor/FlowNetworkEditor.tsx","geometry/index.tsx","components/flow/FlowNode.tsx","components/FlowNetworkEditor/SmartButton.tsx","App.tsx","index.tsx"],"names":["sleep","ms","timeout","Math","max","Promise","resolve","setTimeout","findPath","a","node","visited","increase","newVisited","sink","path","dest","capacity","find","e","currentFlow","flow","arcIncrease","min","Object","entries","arcsWithBackward","arcs","source","onUpdate","keys","reduce","acc","to","from","augmentingPath","Infinity","i","length","b","forward","highligthedPath","asPixels","value","EDITOR_ACTIONS","useStyles","createUseStyles","arcLabel","position","top","arrow","display","left","border","borderWidth","width","height","transform","FlowArc","memo","props","rad","start","x","startX","y","startY","end","endX","endY","classes","sqrt","pow","pos","middle","orientation","atan","PI","angle","red","rgb","map","gCh","style","backgroundColor","join","className","makeStyles","theme","label","marginTop","spacing","FlowNode","draggable","onClick","preventDefault","stopPropagation","id","onDrag","event","onDragStart","img","Image","src","dataTransfer","setDragImage","positionY","positionX","bgColor","SmartButton","disabled","otherProps","Button","variant","children","canvas","useMUIStyles","root","margin","grow","flexGrow","absoluteCoordinate","normalizedCoordinate","absolutePosition","normalizedPosition","window","innerWidth","innerHeight","relativePosition","reducer","state","action","type","ADD_NODE","newNode","payload","fixedSink","nodes","REMOVE_NODE","values","wasSink","wasSource","selectedNode","undefined","ADD_ARC","MOVE_NODE","SET_SOURCE","SET_SINK","SELECT_NODE","FlowNetworkEditor","useState","setFlow","useReducer","dispatch","dragHandler","useCallback","clientX","clientY","canvasClickHandler","Date","now","nodeClickHandler","useMemo","round","random","runClickHandler","then","fordFulkerson","deleteClickHandler","sourceMarkClickHandler","sinkMarkClickHandler","muiClasses","Bar","AppBar","Toolbar","ButtonGroup","startIcon","color","flat","App","document","addEventListener","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.19e8418b.chunk.js","sourcesContent":["export function sleep(ms: number) {\r\n    const timeout = Math.max(0, ms)\r\n    return new Promise(resolve => setTimeout(resolve, timeout))\r\n}","import { sleep } from \"../utils/sleep\"\r\n\r\ntype Arcs = { [from: string]: { [to: string]: number } }\r\n\r\n\r\ntype MaxFlowParams = {\r\n  source: string\r\n  sink: string\r\n  arcs: Arcs,\r\n  onUpdate?: (update: MaxFlowUpdate) => void\r\n}\r\n\r\ntype MaxFlowUpdate = {\r\n  highligthedPath?: string[],\r\n  flow: Arcs\r\n}\r\n\r\nexport async function fordFulkerson({\r\n  arcs,\r\n  source,\r\n  sink,\r\n  onUpdate = () => { }\r\n}: MaxFlowParams) {\r\n\r\n  const flow: Arcs = {}\r\n\r\n  const arcsWithBackward = Object.keys(arcs).reduce<Arcs>((acc, to) => {\r\n    for (const from of Object.keys(arcs[to])) {\r\n      if (!acc[from]) {\r\n        acc[from] = {}\r\n      }\r\n      if (!acc[to]) {\r\n        acc[to] = {}\r\n      }\r\n      acc[to][from] = arcs[to][from]\r\n      //mark backwards with negative capacity\r\n      acc[from][to] = -acc[to][from]\r\n    }\r\n    return acc\r\n  }, {})\r\n\r\n  function findPath(node: string, visited: string[], increase: number): { visited: string[], increase: number } | null {\r\n    const newVisited = [...visited, node]\r\n\r\n    if (node === sink) {\r\n      //we have arrived\r\n      return {\r\n        visited: newVisited,\r\n        increase\r\n      }\r\n    }\r\n\r\n    let path = null\r\n    for (const [dest, capacity] of Object.entries(arcsWithBackward[node] ?? {})) {\r\n\r\n      if (visited.find((e) => e === dest)) {\r\n        continue\r\n      }\r\n\r\n      const currentFlow = flow[node]?.[dest] ?? 0\r\n\r\n      //if capacity is negative we are looking at a backward arc\r\n      const arcIncrease = capacity >= 0 ? capacity - currentFlow : currentFlow\r\n\r\n      if (arcIncrease > 0) {\r\n        path = findPath(dest, newVisited, Math.min(increase, arcIncrease))\r\n        //we got a path\r\n        if (path) {\r\n          break\r\n        }\r\n      }\r\n    }\r\n\r\n    return path\r\n  }\r\n\r\n  let augmentingPath = findPath(source, [], Infinity)\r\n  while (augmentingPath) {\r\n    const visited = augmentingPath?.visited\r\n    for (let i = 0; i < visited.length - 1; i++) {\r\n      const [a, b] = [visited[i], visited[i + 1]]\r\n      if (!flow[a]) {\r\n        flow[a] = {}\r\n      }\r\n      //check if it was a backward arc\r\n      const forward = !!arcs[a][b]\r\n      const arcIncrease = augmentingPath.increase * (forward ? 1 : -1)\r\n\r\n      const [from, to] = forward ? [a, b] : [b, a]\r\n\r\n      if (!flow[from][to]) {\r\n        flow[from][to] = arcIncrease\r\n      } else {\r\n        flow[from][to] += arcIncrease\r\n      }\r\n    }\r\n    onUpdate({ highligthedPath: [...augmentingPath?.visited], flow: {...flow} })\r\n    augmentingPath = findPath(source, [], Infinity)\r\n    await sleep(1000)\r\n  }\r\n\r\n  return flow\r\n}","export function asPixels(value: number) {\n  return value + 'px'\n}\nexport function cssAngle(rad: number) {\n  return `rotate(${rad}rad)`\n}\n","import React, { memo } from 'react'\nimport { angle, distance, middle } from '../../geometry/index';\nimport { asPixels, cssAngle } from '../../utils/index';\nimport { createUseStyles } from 'react-jss'\n\nconst useStyles = createUseStyles({\n  arcLabel: {\n    position: 'absolute',\n    top: '10px'\n  },\n  arrow: {\n    display: 'inline-block',\n    position: 'absolute',\n    top: '-2px',\n    left: '20px',\n    border: 'solid black',\n    borderWidth:' 0 3px 3px 0',\n    width: '6px',\n    height: '6px',\n    transform: 'rotate(-45deg)',\n  },\n})\n\nexport const FlowArc = memo((props: {\n  startX: number,\n  startY: number,\n  endX: number,\n  endY: number,\n  capacity: number\n  flow: number\n}) => {\n\n  const start = {x: props.startX, y: props.startY}\n  const end = {x: props.endX, y: props.endY}\n  const classes = useStyles()\n  const { capacity, flow } = props\n  const length = distance(start, end)\n  const pos = middle(start, end)\n  const orientation = angle(start, end)\n\n  const green = [0, 255, 0]\n  const red = [255, 0, 0]\n  const rgb = green.map((gCh, i) => gCh + (red[i] - gCh) * flow / capacity)\n  const style = {\n    top: asPixels(pos.y),\n    left: asPixels(pos.x),\n    width: asPixels(length),\n    transform: `translateX(${-length / 2}px)` + cssAngle(orientation),\n    backgroundColor: `rgb(${rgb.join(',')})`\n  }\n\n  return <div className='flow-arc' style={style}>\n    <i className={classes.arrow} />\n    <span className={classes.arcLabel}>{flow}/{capacity}</span>\n  </div>\n})","import { AppBar, ButtonGroup, makeStyles, Toolbar } from \"@material-ui/core\";\n\nimport { useCallback, useMemo, useReducer, useState } from \"react\";\nimport { createUseStyles } from \"react-jss\";\nimport { Point } from \"../../geometry\";\nimport { fordFulkerson } from \"../../maxflow\";\nimport { FlowArc, FlowNetworkNode } from \"../flow\";\nimport { NodeId, NumericLabeledArcs } from \"../types\";\nimport { SmartButton } from \"./SmartButton\";\nimport FlagIcon from '@material-ui/icons/Flag';\nimport PlayArrowIcon from \"@material-ui/icons/PlayArrow\";\nimport InputIcon from '@material-ui/icons/Input';\nimport DeleteIcon from '@material-ui/icons/Delete';\n\nconst useStyles = createUseStyles({\n  canvas: {\n    width: '100%',\n    height: '100vh',\n  }\n})\n\nconst useMUIStyles = makeStyles((theme) => ({\n  root: {\n    '& > *': {\n      margin: theme.spacing(1),\n    },\n  },\n  grow: {\n    flexGrow: 1,\n  },\n}));\n\ntype NodeData = {\n  id: string,\n  position: Point,\n}\n\nfunction absoluteCoordinate(normalizedCoordinate: number, length: number) {\n  return (length + normalizedCoordinate * length) / 2\n}\nfunction normalizedCoordinate(absoluteCoordinate: number, length: number) {\n  return (absoluteCoordinate * 2 - length) / length\n}\n\nfunction absolutePosition(normalizedPosition: Point) {\n  return {\n    x: absoluteCoordinate(normalizedPosition.x, window.innerWidth),\n    y: absoluteCoordinate(normalizedPosition.y, window.innerHeight),\n  }\n}\n\nfunction relativePosition(absolutePosition: Point) {\n  return {\n    x: normalizedCoordinate(absolutePosition.x, window.innerWidth),\n    y: normalizedCoordinate(absolutePosition.y, window.innerHeight),\n  }\n}\n\nenum EDITOR_ACTIONS {\n  ADD_NODE,\n  REMOVE_NODE,\n  MOVE_NODE,\n  ADD_ARC,\n  SET_SOURCE,\n  SET_SINK,\n  SELECT_NODE\n}\n\ntype Action =\n  { type: EDITOR_ACTIONS.ADD_NODE, payload: NodeData }\n  | { type: EDITOR_ACTIONS.REMOVE_NODE, payload: NodeId }\n  | { type: EDITOR_ACTIONS.MOVE_NODE, payload: { id: NodeId, position: Point } }\n  | { type: EDITOR_ACTIONS.ADD_ARC, payload: { from: NodeId, to: NodeId, capacity: number } }\n  | { type: EDITOR_ACTIONS.SET_SOURCE, payload: NodeId | undefined }\n  | { type: EDITOR_ACTIONS.SET_SINK, payload: NodeId | undefined }\n  | { type: EDITOR_ACTIONS.SELECT_NODE, payload: NodeId }\n\n\ntype EditorState = {\n  nodes: { [id: string]: NodeData }\n  arcs: NumericLabeledArcs\n  flow: NumericLabeledArcs\n  source?: NodeId\n  sink?: NodeId\n  selectedNode?: NodeId\n  fixedSink: boolean,\n}\n\nfunction reducer(state: EditorState, action: Action): EditorState {\n  switch (action.type) {\n    case EDITOR_ACTIONS.ADD_NODE:\n      const newNode = action.payload\n      return {\n        ...state,\n        source: state.source ?? newNode.id,\n        sink:  !state.source || state.fixedSink ? state.sink : newNode.id,\n        nodes: {\n          ...state.nodes,\n          [newNode.id]: newNode\n        }\n      }\n    case EDITOR_ACTIONS.REMOVE_NODE:\n      const { [action.payload]: deleted, ...nodes } = state.nodes\n      const { [action.payload]: arcsFromRemovedNode, ...arcs } = state.arcs\n\n      //remove the ingoing arcs to the node\n      for (const tos of Object.values(arcs)) {\n        delete tos[action.payload]\n      }\n      const wasSink = action.payload === state.sink\n      const wasSource = action.payload === state.sink\n      return {\n        ...state,\n        arcs,\n        nodes,\n        selectedNode: action.payload !== state.selectedNode ? state.selectedNode : undefined,\n        source: wasSource ? state.source : undefined,\n        sink: wasSink ? state.source : undefined,\n        fixedSink: wasSink ? false : state.fixedSink\n      }\n    case EDITOR_ACTIONS.ADD_ARC:\n      return {\n        ...state,\n        selectedNode: undefined,\n        arcs: {\n          ...state.arcs,\n          [action.payload.from]: {\n            ...state.arcs[action.payload.from],\n            [action.payload.to]: action.payload.capacity\n          }\n        },\n      }\n    case EDITOR_ACTIONS.MOVE_NODE:\n      return {\n        ...state,\n        nodes: {\n          ...state.nodes,\n          [action.payload.id]: {\n            ...state.nodes[action.payload.id],\n            position: action.payload.position\n          }\n        }\n      }\n    case EDITOR_ACTIONS.SET_SOURCE:\n      return {\n        ...state,\n        selectedNode: undefined,\n        source: action.payload\n      }\n    case EDITOR_ACTIONS.SET_SINK:\n      return {\n        ...state,\n        selectedNode: undefined,\n        sink: action.payload,\n        fixedSink: true\n      }\n    case EDITOR_ACTIONS.SELECT_NODE:\n      return {\n        ...state,\n        selectedNode: action.payload !== state.selectedNode ? action.payload : undefined\n      }\n    default:\n      return state\n\n  }\n}\n\n\nexport function FlowNetworkEditor() {\n\n  const [flow, setFlow] = useState<NumericLabeledArcs>({})\n\n  const [state, dispatch] = useReducer(reducer, {\n    nodes: {},\n    arcs: {},\n    flow: {},\n    fixedSink: false\n  })\n\n  const { sink, source, selectedNode } = state\n  const dragHandler = useCallback((id, event) => {\n\n    event.preventDefault()\n    const position = relativePosition({ x: event.clientX, y: event.clientY })\n\n    dispatch({\n      type: EDITOR_ACTIONS.MOVE_NODE,\n      payload: {\n        id,\n        position\n      }\n    })\n\n  }, [])\n\n  const canvasClickHandler = useCallback((e: React.MouseEvent) => {\n    dispatch({\n      type: EDITOR_ACTIONS.ADD_NODE,\n      payload: {\n        id: '' + Date.now(),\n        position: relativePosition({ x: e.clientX, y: e.clientY })\n      }\n    })\n  }, [])\n\n\n  const nodeClickHandler = useMemo(() => {\n    return (id: NodeId) => {\n\n      if (!selectedNode || id === selectedNode) {\n        dispatch({\n          type: EDITOR_ACTIONS.SELECT_NODE,\n          payload: id\n        })\n        return\n      }\n\n      //we add the new arc\n      if (!state.arcs[selectedNode]?.[id] && !state.arcs[id]?.[selectedNode]) {\n        dispatch({\n          type: EDITOR_ACTIONS.ADD_ARC,\n          payload: {\n            from: selectedNode,\n            to: id,\n            capacity: Math.round(8 * Math.random()) + 2\n          }\n        })\n      }\n    }\n  }, [selectedNode, state.arcs])\n\n  const runClickHandler = useMemo(() => {\n    return source && sink ? () => {\n      Promise.resolve()\n        .then(() => {\n          return fordFulkerson({\n            source,\n            sink,\n            arcs: state.arcs,\n            onUpdate: ({ flow, highligthedPath }) => {\n              setFlow(flow)\n            }\n          })\n        })\n        .then(setFlow)\n    } : undefined\n  }, [state.arcs, source, sink])\n\n  const deleteClickHandler = useMemo(() => {\n    return selectedNode ? () => {\n      //remove the node\n      dispatch({\n        type: EDITOR_ACTIONS.REMOVE_NODE,\n        payload: selectedNode,\n      })\n\n    } : undefined\n  },\n    [selectedNode])\n\n  const sourceMarkClickHandler = useMemo(() => {\n    return selectedNode && selectedNode !== sink ? () => {\n      dispatch({\n        type: EDITOR_ACTIONS.SET_SOURCE,\n        payload: selectedNode !== source ? selectedNode : undefined,\n      })\n    } : undefined\n  }, [selectedNode, sink, source])\n\n  const sinkMarkClickHandler = useMemo(() => {\n    return selectedNode && selectedNode !== source ? () => {\n      dispatch({\n        type: EDITOR_ACTIONS.SET_SINK,\n        payload: selectedNode !== sink ? selectedNode : undefined,\n      })\n    } : undefined\n  }, [selectedNode, sink, source])\n\n\n  const classes = useStyles()\n  const muiClasses = useMUIStyles()\n\n  const Bar = useMemo(() => <AppBar position=\"fixed\">\n    <Toolbar className={muiClasses.root}>\n      <div className={muiClasses.grow} />\n      <ButtonGroup variant='contained' >\n        <SmartButton onClick={sourceMarkClickHandler} startIcon={<InputIcon />}>{selectedNode === source ? 'Unm' : 'M'}ark as source</SmartButton>\n        <SmartButton onClick={sinkMarkClickHandler} startIcon={<FlagIcon />}>{selectedNode === sink ? 'Unm' : 'M'}ark as sink</SmartButton>\n        <SmartButton onClick={deleteClickHandler} startIcon={<DeleteIcon />}>Delete</SmartButton>\n      </ButtonGroup>\n      <SmartButton onClick={runClickHandler} color='primary' variant='contained' startIcon={<PlayArrowIcon />}>Compute</SmartButton>\n    </Toolbar>\n  </AppBar>, [sourceMarkClickHandler, sinkMarkClickHandler, runClickHandler, deleteClickHandler, source, sink, selectedNode, muiClasses])\n\n  return <>\n    {Bar}\n    <div onClick={canvasClickHandler} className={classes.canvas}>\n      {\n        Object.values(state.nodes).map(node => {\n          const pos = absolutePosition(node.position)\n          return <FlowNetworkNode\n            key={node.id}\n            onDrag={dragHandler}\n            onClick={() => nodeClickHandler(node.id)}\n            {...node}\n            positionX={pos.x}\n            positionY={pos.y}\n            bgColor={node.id === selectedNode ? 'red' : undefined}\n            label={sink === node.id ? <FlagIcon /> : (source === node.id ? <InputIcon /> : undefined)}\n          />\n        })\n      }\n      {\n        Object.keys(state.arcs).map(from => Object.keys(state.arcs[from]).map(to => {\n          const start = absolutePosition(state.nodes[from].position)\n          const end = absolutePosition(state.nodes[to].position)\n\n          return <FlowArc\n            key={from + '-' + to}\n            flow={flow[from]?.[to] || 0}\n            capacity={state.arcs[from][to]}\n            startX={start.x}\n            startY={start.y}\n            endX={end.x}\n            endY={end.y}\n          />\n        })).flat()\n      }\n    </div>\n  </>\n\n}","\nexport type Point = {\n  x: number;\n  y: number;\n}\nexport type RectangleSize = {\n  width: number\n  height: number\n}\n\nfunction randomPoint(): Point {\n  function randomCoordinate() {\n    return -1 + Math.random() * 2\n  }\n  return { x: randomCoordinate(), y: randomCoordinate() }\n}\n\nfunction distance(a: Point, b: Point) {\n  return Math.sqrt(Math.pow(a.x - b.x, 2) + Math.pow(a.y - b.y, 2))\n}\n\nfunction middle(a: Point, b: Point) {\n  return {\n    x: (a.x + b.x) / 2,\n    y: (a.y + b.y) / 2,\n  }\n}\n\nfunction angle(a: Point, b: Point) {\n  return Math.atan((b.y - a.y) / (b.x - a.x)) + ( b.x < a.x ? Math.PI : 0)\n}\n\nfunction absolutePosition(position: Point): Point {\n  return {\n    x: 250 + position.x * 250,\n    y: 250 + position.y * 250\n  }\n}\n\nexport {\n  distance,\n  middle,\n  angle,\n  randomPoint,\n  absolutePosition\n}","import { makeStyles } from \"@material-ui/core\";\nimport React, { DragEvent, memo } from \"react\"\n\nimport { asPixels } from '../../utils/index';\nimport { NodeId } from \"../types\";\n\nconst useStyles = makeStyles((theme) => ({\n  label: {\n\n    display: 'inline-block',\n    marginTop: theme.spacing(1)\n  },\n}));\n\nexport const FlowNode = memo((props: {\n  id: NodeId\n  positionX: number,\n  positionY: number,\n  onClick: (id: NodeId) => void\n  onDrag: (id: NodeId, event: DragEvent) => void\n  bgColor?: string\n  label?: React.ReactNode\n}) => {\n  const classes = useStyles()\n\n  const dragStartHandler = (event: DragEvent) => {\n    var img = new Image();\n    img.src = 'data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=';\n    event.dataTransfer.setDragImage(img, 0, 0);\n  }\n  return (\n    <div\n      className='flow-node'\n      draggable={true}\n      onClick={(e) => {\n        e.preventDefault()\n        e.stopPropagation()\n        props.onClick(props.id)\n      }}\n      onDrag={(event) => props.onDrag(props.id, event)}\n      onDragStart={dragStartHandler}\n      style={\n        {\n          top: asPixels(props.positionY),\n          left: asPixels(props.positionX),\n          backgroundColor: props.bgColor,\n        }}>\n      {props.id}\n      <span className={classes.label}>\n        {props.label}\n      </span>\n    </div>\n  )\n})\n\n\n","import { Button } from \"@material-ui/core\";\nimport { memo } from \"react\";\n\n\nexport const SmartButton = memo((props: React.ComponentProps<typeof Button>) => {\n    const {onClick, disabled, ...otherProps} = props\n    return <Button\n        variant='contained'\n        onClick={props.onClick}\n        disabled={!props.onClick}\n        {...otherProps}\n        >\n        {props.children}\n    </Button>\n})","import './App.css'\nimport { FlowNetworkEditor } from './components/FlowNetworkEditor';\n\nfunction App() {\n\n  return (\n    <FlowNetworkEditor />\n  )\n}\n\nexport default App","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\ndocument.addEventListener('dragover', function (event) {\n\n  // prevent default to allow drop\n  event.preventDefault();\n\n}, false);\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n"],"sourceRoot":""}