{"version":3,"sources":["utils/index.tsx","components/flow/FlowArc.tsx","geometry/index.tsx","components/flow/FlowNode.tsx","components/FlowNetworkEditor/SmartButton.tsx","components/FlowNetworkEditor/FlowNetworkEditor.tsx","maxflow/FordFulkerson.tsx","App.tsx","index.tsx"],"names":["asPixels","value","useStyles","createUseStyles","arcLabel","position","top","arrow","display","left","border","borderWidth","width","height","transform","FlowArc","props","a","b","rad","classes","start","end","capacity","flow","length","Math","sqrt","pow","x","y","pos","middle","orientation","atan","PI","angle","red","rgb","map","gCh","i","style","backgroundColor","join","className","label","FlowNode","draggable","onClick","e","preventDefault","stopPropagation","id","onDrag","onDragStart","event","img","Image","src","dataTransfer","setDragImage","bgColor","SmartButton","disabled","otherProps","Button","variant","children","canvas","useMUIStyles","makeStyles","theme","root","margin","spacing","grow","flexGrow","Node","this","Graph","_nodes","_adjacencyTable","Error","from","to","Object","entries","tos","filter","flat","absoluteCoordinate","normalizedCoordinate","absolutePosition","normalizedPosition","window","innerWidth","innerHeight","relativePosition","FlowNetworkEditor","muiClasses","useState","nodeData","setNodeData","arcs","setArcs","setFlow","undefined","source","setSource","sink","setSink","selectedNode","setSelectedNode","graph","values","forEach","node","addNode","addArc","dragHandler","useCallback","newPos","clientX","clientY","prev","canvasClickHandler","newNode","keys","nodeClickHandler","round","random","runClickHandler","Promise","resolve","arcsWithBackward","reduce","acc","findPath","visited","increase","newVisited","path","dest","find","currentFlow","arcIncrease","min","augmentingPath","Infinity","forward","fordFulkerson","then","deleteClickHandler","otherArcs","otherNodes","sourceMarkClickHandler","sinkMarkClickHandler","graphNodes","getNodes","AppBar","Toolbar","ButtonGroup","color","startIcon","PlayArrow","getArcs","App","document","addEventListener","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.42943a67.chunk.js","sourcesContent":["export function asPixels(value: number) {\n  return value + 'px'\n}\nexport function cssAngle(rad: number) {\n  return `rotate(${rad}rad)`\n}","import React from 'react'\nimport { angle, distance, middle, Point } from '../../geometry/index';\nimport { asPixels, cssAngle } from '../../utils/index';\nimport { createUseStyles } from 'react-jss'\n\nconst useStyles = createUseStyles({\n  arcLabel: {\n    position: 'absolute',\n    top: '10px'\n  },\n  arrow: {\n    display: 'inline-block',\n    position: 'absolute',\n    top: '-2px',\n    left: '20px',\n    border: 'solid black',\n    borderWidth:' 0 3px 3px 0',\n    width: '6px',\n    height: '6px',\n    transform: 'rotate(-45deg)',\n  },\n})\n\nexport function FlowArc(props: {\n  start: Point\n  end: Point\n  capacity: number\n  flow: number\n}) {\n\n  const classes = useStyles()\n  const { start, end, capacity, flow } = props\n  const length = distance(start, end)\n  const pos = middle(start, end)\n  const orientation = angle(start, end)\n\n  const green = [0, 255, 0]\n  const red = [255, 0, 0]\n  const rgb = green.map((gCh, i) => gCh + (red[i] - gCh) * flow / capacity)\n  const style = {\n    top: asPixels(pos.y),\n    left: asPixels(pos.x),\n    width: asPixels(length),\n    transform: `translateX(${-length / 2}px)` + cssAngle(orientation),\n    backgroundColor: `rgb(${rgb.join(',')})`\n  }\n\n  return <div className='flow-arc' style={style}>\n    <i className={classes.arrow} />\n    <span className={classes.arcLabel}>{flow}/{capacity}</span>\n  </div>\n}","\nexport type Point = {\n  x: number;\n  y: number;\n}\nexport type RectangleSize = {\n  width: number\n  height: number\n}\n\nfunction randomPoint(): Point {\n  function randomCoordinate() {\n    return -1 + Math.random() * 2\n  }\n  return { x: randomCoordinate(), y: randomCoordinate() }\n}\n\nfunction distance(a: Point, b: Point) {\n  return Math.sqrt(Math.pow(a.x - b.x, 2) + Math.pow(a.y - b.y, 2))\n}\n\nfunction middle(a: Point, b: Point) {\n  return {\n    x: (a.x + b.x) / 2,\n    y: (a.y + b.y) / 2,\n  }\n}\n\nfunction angle(a: Point, b: Point) {\n  return Math.atan((b.y - a.y) / (b.x - a.x)) + ( b.x < a.x ? Math.PI : 0)\n}\n\nfunction absolutePosition(position: Point): Point {\n  return {\n    x: 250 + position.x * 250,\n    y: 250 + position.y * 250\n  }\n}\n\nexport {\n  distance,\n  middle,\n  angle,\n  randomPoint,\n  absolutePosition\n}","import React, { DragEvent } from \"react\"\nimport { createUseStyles } from \"react-jss\";\n\nimport { Point } from \"../../geometry\"\nimport { asPixels } from '../../utils/index';\nimport { NodeId } from \"../types\";\n\nconst useStyles = createUseStyles({\n  label: {\n    position: 'absolute',\n    top: '-2em'\n  }\n})\nexport function FlowNode(props: {\n  id: NodeId\n  position: Point\n  onClick: (id: NodeId) => void\n  onDrag: (event: DragEvent) => void\n  bgColor?: string\n  label?: string\n}) {\n  const classes = useStyles()\n\n  const dragStartHandler = (event: DragEvent) => {\n    var img = new Image();\n    img.src = 'data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=';\n    event.dataTransfer.setDragImage(img, 0, 0);\n  }\n\n  return (\n    <div\n      className='flow-node'\n      draggable={true}\n      onClick={(e) => {\n        e.preventDefault()\n        e.stopPropagation()\n        props.onClick(props.id)\n      }}\n      onDrag={props.onDrag}\n      onDragStart={dragStartHandler}\n      style={\n        {\n          top: asPixels(props.position.y),\n          left: asPixels(props.position.x),\n          backgroundColor: props.bgColor,\n        }}>\n      {props.id}\n      {props.label ? <span className={classes.label}>{props.label}</span> : null}\n    </div>\n  )\n}\n\n\n","import { Button } from \"@material-ui/core\";\r\n\r\n\r\nexport function SmartButton(props: React.ComponentProps<typeof Button>) {\r\n    const {onClick, disabled, ...otherProps} = props\r\n    return <Button\r\n        variant='contained'\r\n        onClick={props.onClick}\r\n        disabled={!props.onClick}\r\n        {...otherProps}\r\n        >\r\n        {props.children}\r\n    </Button>\r\n}","import { AppBar, ButtonGroup, makeStyles, Toolbar } from \"@material-ui/core\";\r\nimport { PlayArrow } from \"@material-ui/icons\";\r\nimport { useCallback, useState } from \"react\";\r\nimport { createUseStyles } from \"react-jss\";\r\nimport { Point } from \"../../geometry\";\r\nimport { fordFulkerson } from \"../../maxflow\";\r\nimport { FlowArc, FlowNetworkNode } from \"../flow\";\r\nimport { NodeId, NumericLabeledArcs } from \"../types\";\r\nimport { SmartButton } from \"./SmartButton\";\r\n\r\nconst useStyles = createUseStyles({\r\n    canvas: {\r\n        width: '100%',\r\n        height: '100vh',\r\n    }\r\n})\r\n\r\nconst useMUIStyles = makeStyles((theme) => ({\r\n    root: {\r\n        '& > *': {\r\n            margin: theme.spacing(1),\r\n        },\r\n    },\r\n    grow: {\r\n        flexGrow: 1,\r\n    },\r\n}));\r\n\r\nclass Node<T>{\r\n    private id: NodeId\r\n    public value: T\r\n\r\n    constructor(id: NodeId, value: T) {\r\n        this.id = id;\r\n        this.value = value\r\n    }\r\n}\r\n\r\nclass Graph<T>{\r\n    private _nodes: { [id: string]: Node<T> } = {}\r\n    private _adjacencyTable: { [from: string]: { [to: string]: boolean } } = {}\r\n\r\n    addNode(id: string, value: T) {\r\n        if ((id in this._nodes)) {\r\n            throw new Error('Conflicting node id')\r\n        }\r\n\r\n        this._nodes[id] = new Node(id, value)\r\n    }\r\n\r\n    addArc(from: string, to: string) {\r\n        if (!this._adjacencyTable[from]) {\r\n            this._adjacencyTable[from] = {}\r\n        }\r\n        this._adjacencyTable[from][to] = true\r\n    }\r\n\r\n    getNodes() {\r\n        return this._nodes\r\n    }\r\n\r\n    getArcs() {\r\n        return Object.entries(this._adjacencyTable).map(([from, tos]) => {\r\n            return Object.entries(tos).filter(([, linked]) => linked).map(([to]) => [from, to])\r\n        }).flat()\r\n    }\r\n}\r\n\r\nclass FlowNode {\r\n    public id;\r\n    public position: Point\r\n    constructor(id: string, position: Point) {\r\n        this.id = id\r\n        this.position = position\r\n    }\r\n\r\n    toString() {\r\n        return this.id\r\n    }\r\n}\r\n\r\ntype NodeData = {\r\n    id: string,\r\n    position: Point,\r\n}\r\n\r\nfunction absoluteCoordinate(normalizedCoordinate: number, length: number) {\r\n    return (length + normalizedCoordinate * length) / 2\r\n}\r\nfunction normalizedCoordinate(absoluteCoordinate: number, length: number) {\r\n    return (absoluteCoordinate * 2 - length) / length\r\n}\r\n\r\nfunction absolutePosition(normalizedPosition: Point) {\r\n    return {\r\n        x: absoluteCoordinate(normalizedPosition.x, window.innerWidth),\r\n        y: absoluteCoordinate(normalizedPosition.y, window.innerHeight),\r\n    }\r\n}\r\n\r\nfunction relativePosition(absolutePosition: Point) {\r\n    return {\r\n        x: normalizedCoordinate(absolutePosition.x, window.innerWidth),\r\n        y: normalizedCoordinate(absolutePosition.y, window.innerHeight),\r\n    }\r\n}\r\n\r\nexport function FlowNetworkEditor() {\r\n    const muiClasses = useMUIStyles()\r\n    const [nodeData, setNodeData] = useState<{ [id: string]: NodeData }>({})\r\n    const [arcs, setArcs] = useState<NumericLabeledArcs>({})\r\n    const [flow, setFlow] = useState<NumericLabeledArcs>({})\r\n    const [source, setSource] = useState<NodeId | undefined>(undefined)\r\n    const [sink, setSink] = useState<NodeId | undefined>(undefined)\r\n    const [defaultArcCapacity] = useState(10)\r\n\r\n    const [selectedNode, setSelectedNode] = useState<NodeId | undefined>(undefined)\r\n\r\n    const graph = new Graph<FlowNode>();\r\n\r\n    Object.values(nodeData).forEach((node) => {\r\n        graph.addNode(node.id, new FlowNode(node.id, node.position))\r\n    })\r\n\r\n    for (const [from, tos] of Object.entries(arcs)) {\r\n        for (const [to] of Object.entries(tos)) {\r\n            graph.addArc(from, to)\r\n        }\r\n    }\r\n\r\n    const dragHandler = useCallback((id, event) => {\r\n        event.preventDefault()\r\n        const newPos = relativePosition({ x: event.clientX, y: event.clientY })\r\n        setNodeData((prev) => {\r\n            return {\r\n                ...prev,\r\n                [id]: {\r\n                    id,\r\n                    position: newPos\r\n                }\r\n            }\r\n        })\r\n    }, [setNodeData])\r\n\r\n    const canvasClickHandler = useCallback((e: React.MouseEvent) => {\r\n\r\n        setNodeData((prev) => {\r\n\r\n            //add a new node\r\n            const newNode = {\r\n                id: '' + Object.keys(prev).length,\r\n                position: relativePosition({ x: e.clientX, y: e.clientY })\r\n            }\r\n\r\n            return {\r\n                ...prev,\r\n                [newNode.id]: newNode,\r\n            }\r\n        })\r\n    }, [setNodeData])\r\n\r\n    const nodeClickHandler = selectedNode ? (id: NodeId) => {\r\n        //we add the new arc\r\n        if (id !== selectedNode) {\r\n            setArcs((prev) => ({\r\n                ...prev,\r\n                [selectedNode]: {\r\n                    ...prev[selectedNode],\r\n                    [id]: Math.round(8 * Math.random()) + 2\r\n                }\r\n            }))\r\n        }\r\n        setSelectedNode(undefined)\r\n    } : setSelectedNode\r\n\r\n    const runClickHandler = source && sink ? () => {\r\n        new Promise<NumericLabeledArcs>((resolve) => {\r\n            const flow = fordFulkerson(source, sink, arcs)\r\n            resolve(flow)\r\n        }).then(setFlow)\r\n    } : undefined\r\n\r\n    const deleteClickHandler = selectedNode ? () => {\r\n        if (source === selectedNode) {\r\n            setSource(undefined)\r\n        }\r\n\r\n        if (sink === selectedNode) {\r\n            setSink(undefined)\r\n        }\r\n        setSelectedNode(undefined)\r\n\r\n        //remove the arcs from and to the node\r\n        const { [selectedNode]: fromDeletedNodeArcs, ...otherArcs } = arcs\r\n\r\n        //remove the ingoing arcs to the node\r\n        for (const tos of Object.values(otherArcs)) {\r\n            delete tos[selectedNode]\r\n        }\r\n\r\n        setArcs(otherArcs)\r\n        //remove the node\r\n        const { [selectedNode]: deletedNode, ...otherNodes } = nodeData\r\n        setNodeData(otherNodes)\r\n\r\n    } : undefined\r\n\r\n    const sourceMarkClickHandler = selectedNode && selectedNode !== sink ? () => {\r\n        if (selectedNode === source) {\r\n            setSource(undefined)\r\n        } else {\r\n            setSource(selectedNode)\r\n        }\r\n        setSelectedNode(undefined)\r\n    } : undefined\r\n\r\n    const sinkMarkClickHandler = selectedNode && selectedNode !== source ? () => {\r\n        if (selectedNode === sink) {\r\n            setSink(undefined)\r\n        } else {\r\n            setSink(selectedNode)\r\n        }\r\n        setSelectedNode(undefined)\r\n    } : undefined\r\n\r\n    const classes = useStyles()\r\n    const graphNodes = graph.getNodes()\r\n\r\n    return <>\r\n        <AppBar position=\"fixed\">\r\n            <Toolbar className={muiClasses.root}>\r\n                <div className={muiClasses.grow} />\r\n                <ButtonGroup variant='contained' >\r\n                    <SmartButton onClick={sourceMarkClickHandler}>{selectedNode === source ? 'Unm' : 'M'}ark as source</SmartButton>\r\n                    <SmartButton onClick={sinkMarkClickHandler}>{selectedNode === sink ? 'Unm' : 'M'}ark as sink</SmartButton>\r\n                    <SmartButton onClick={deleteClickHandler}>Delete</SmartButton>\r\n                </ButtonGroup>\r\n                <SmartButton onClick={runClickHandler} color='primary' variant='contained' startIcon={<PlayArrow />}>Compute</SmartButton>\r\n            </Toolbar>\r\n        </AppBar>\r\n        <div onClick={canvasClickHandler} className={classes.canvas}>\r\n            {\r\n                Object.values(graphNodes).map(({ value }) => {\r\n                    return <FlowNetworkNode\r\n                        key={value.id}\r\n                        onDrag={(event) => dragHandler(value.id, event)}\r\n                        onClick={nodeClickHandler}\r\n                        {...value}\r\n                        position={absolutePosition(value.position)}\r\n                        bgColor={value.id === selectedNode ? 'red' : undefined}\r\n                        label={sink === value.id ? 'sink' : (source === value.id ? 'source' : undefined)}\r\n                    />\r\n                })\r\n            }\r\n            {\r\n                graph.getArcs().map(([from, to]) => {\r\n                    return <FlowArc\r\n                        key={from + '-' + to}\r\n                        flow={flow[from]?.[to] || 0}\r\n                        capacity={arcs[from][to]}\r\n                        start={absolutePosition(graphNodes[from].value.position)}\r\n                        end={absolutePosition(graphNodes[to].value.position)}\r\n                    />\r\n                })\r\n            }\r\n        </div>\r\n    </>\r\n\r\n}","type Arcs = { [from: string]: { [to: string]: number } }\r\n\r\nexport function fordFulkerson(source: string, sink: string, arcs: Arcs) {\r\n\r\n  const flow: Arcs = {}\r\n\r\n  const arcsWithBackward = Object.keys(arcs).reduce<Arcs>((acc, to) => {\r\n    for (const from of Object.keys(arcs[to])) {\r\n      if (!acc[from]) {\r\n        acc[from] = {}\r\n      }\r\n      if (!acc[to]) {\r\n        acc[to] = {}\r\n      }\r\n      acc[to][from] = arcs[to][from]\r\n      //mark backwards with negative capacity\r\n      acc[from][to] = -acc[to][from]\r\n    }\r\n    return acc\r\n  }, {})\r\n\r\n  function findPath(node: string, visited: string[], increase: number): { visited: string[], increase: number } | null {\r\n    const newVisited = [...visited, node]\r\n\r\n    if (node === sink) {\r\n      //we have arrived\r\n      return {\r\n        visited: newVisited,\r\n        increase\r\n      }\r\n    }\r\n\r\n    let path = null\r\n    for (const [dest, capacity] of Object.entries(arcsWithBackward[node] ?? {})) {\r\n\r\n      if (visited.find((e) => e === dest)) {\r\n        continue\r\n      }\r\n\r\n      const currentFlow = flow[node]?.[dest] ?? 0\r\n\r\n      //if capacity is negative we are looking at a backward arc\r\n      const arcIncrease = capacity >= 0 ? capacity - currentFlow : currentFlow\r\n\r\n      if (arcIncrease > 0) {\r\n        path = findPath(dest, newVisited, Math.min(increase, arcIncrease))\r\n        //we got a path\r\n        if (path) {\r\n          break\r\n        }\r\n      }\r\n    }\r\n\r\n    return path\r\n  }\r\n\r\n  let augmentingPath = findPath(source, [], Infinity)\r\n  while (augmentingPath) {\r\n    const visited = augmentingPath?.visited\r\n    for (let i = 0; i < visited.length - 1; i++) {\r\n      const [a, b] = [visited[i], visited[i + 1]]\r\n      if (!flow[a]) {\r\n        flow[a] = {}\r\n      }\r\n      //check if it was a backward arc\r\n      const forward = !!arcs[a][b]\r\n      const arcIncrease = augmentingPath.increase * (forward ? 1 : -1)\r\n\r\n      const [from, to] = forward ? [a, b] : [b, a]\r\n\r\n      if (!flow[from][to]) {\r\n        flow[from][to] = arcIncrease\r\n      } else {\r\n        flow[from][to] += arcIncrease\r\n      }\r\n    }\r\n\r\n    augmentingPath = findPath(source, [], Infinity)\r\n  }\r\n\r\n  return flow\r\n}","import './App.css'\nimport { FlowNetworkEditor } from './components/FlowNetworkEditor';\n\nfunction App() {\n\n  return (\n    <FlowNetworkEditor />\n  )\n}\n\nexport default App","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\ndocument.addEventListener('dragover', function (event) {\n\n  // prevent default to allow drop\n  event.preventDefault();\n\n}, false);\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n"],"sourceRoot":""}